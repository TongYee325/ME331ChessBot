<!-- <launch>
  <arg
    name="model" />
  <arg
    name="gui"
    default="False" />
  <param
    name="robot_description"
    textfile="$(find urdf)/urdf/urdf.urdf" />
  <param
    name="use_gui"
    value="$(arg gui)" />
  <node
    name="joint_state_publisher"
    pkg="joint_state_publisher"
    type="joint_state_publisher" />
  <node
    name="robot_state_publisher"
    pkg="robot_state_publisher"
    type="state_publisher" />
  <node
    name="rviz"
    pkg="rviz"
    type="rviz"
    args="-d $(find urdf)/urdf.rviz" />
</launch> -->


from launch import LaunchDescription
from launch_ros.actions import Node
from launch.substitutions import LaunchConfiguration, FindPackageShare
from launch.actions import DeclareLaunchArgument
import os

def generate_launch_description():
    # 1. 声明参数（对应ROS 1的<arg>）
    declare_model_arg = DeclareLaunchArgument(
        name="model",
        description="Path to the URDF file (若未指定，默认用包内urdf/urdf.urdf)"
    )
    declare_gui_arg = DeclareLaunchArgument(
        name="gui",
        default_value="False",
        description="是否启用joint_state_publisher_gui"
    )

    # 2. 获取包路径（对应ROS 1的$(find urdf)）
    pkg_urdf_share = FindPackageShare(package='urdf').find('urdf')
    # 拼接URDF文件路径（若未传model参数，默认用包内urdf/urdf.urdf）
    default_urdf_path = os.path.join(pkg_urdf_share, 'urdf', 'urdf.urdf')
    urdf_path = LaunchConfiguration("model", default=default_urdf_path)

    # 3. 拼接RViz配置文件路径（对应ROS 1的$(find urdf)/urdf.rviz）
    rviz_config_path = os.path.join(pkg_urdf_share, 'urdf.rviz')

    # 4. 定义节点（对应ROS 1的<node>）
    # 关节状态发布节点（根据gui参数选择是否启用GUI）
    joint_state_publisher_node = Node(
        package="joint_state_publisher",
        executable="joint_state_publisher" if LaunchConfiguration("gui") == "False" else "joint_state_publisher_gui",
        name="joint_state_publisher",
        parameters=[{"use_gui": LaunchConfiguration("gui")}]  # 对应ROS 1的<param name="use_gui">
    )

    # 机器人状态发布节点
    robot_state_publisher_node = Node(
        package="robot_state_publisher",
        executable="robot_state_publisher",
        name="robot_state_publisher",
        parameters=[{"robot_description": open(urdf_path.perform(None), 'r').read()}]  # 对应ROS 1的<param name="robot_description">
    )

    # RViz节点
    rviz_node = Node(
        package="rviz2",  # ROS 2中包名为rviz2（ROS 1是rviz）
        executable="rviz2",
        name="rviz",
        arguments=["-d", rviz_config_path]  # 对应ROS 1的args参数
    )

    # 5. 组装Launch描述
    return LaunchDescription([
        declare_model_arg,
        declare_gui_arg,
        joint_state_publisher_node,
        robot_state_publisher_node,
        rviz_node
    ])
